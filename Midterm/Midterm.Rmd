---
title: "Midterm - Steve Cheney"
output: html_document
date: "2024-05-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data inports
"143" = journal_1_.pone.0000216.s007
"159" = journal_1_.pone.0000216.s008

```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(gridExtra)
```

```{r}
# S3 / 143
s3_url <- "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1789144/bin/pone.0000216.s007.xls"
s3_file <- "table_s3_143.xls"
curl::curl_download(s3_url, s3_file)
s3_table <- read_excel(s3_file, range = "A4:U147")


# S4 / 159
s4_url <- "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1789144/bin/pone.0000216.s008.xls"
s4_file <- "table_s3_143.xls"
curl::curl_download(s4_url, s4_file)
s4_table <- read_excel(s4_file, range = "A4:U163")

rename_first_three_columns <- function(data_frame) {
  # Rename the first three columns
  names(data_frame)[1:3] <- c("refseq_id", "uniprot_swissprot", "protein_name")
  
  # Return the modified data frame
  return(data_frame)
}

s3_table <- rename_first_three_columns(s3_table)
s4_table <- rename_first_three_columns(s4_table)
```

```{r}
# Calculate the means for s3
s3_means <- s3_table %>%
  reframe(
    chimp_mrna = apply(s3_table[,4:9], 1, mean, na.rm = TRUE),
    human_mrna = apply(s3_table[,10:15], 1, mean, na.rm = TRUE),
    chimp_protein = apply(s3_table[,16:18], 1, mean, na.rm = TRUE),
    human_protein = apply(s3_table[,19:21], 1, mean, na.rm = TRUE)
  )
# Add the means to the s3 table
s3_table <- s3_table %>%
  mutate(
    chimp_mrna_mean = apply(s3_table[,4:9], 1, mean),
    human_mrna_mean = apply(s3_table[,10:15], 1, mean),
    chimp_protein_mean = apply(s3_table[,16:18], 1, mean),
    human_protein_mean = apply(s3_table[,19:21], 1, mean)
  )
# Calculate the means for s4
s4_means <- s4_table %>%
  reframe(
    chimp_mrna = apply(s4_table[,4:9], 1, mean, na.rm = TRUE),
    human_mrna = apply(s4_table[,10:15], 1, mean, na.rm = TRUE),
    chimp_protein = apply(s4_table[,16:18], 1, mean, na.rm = TRUE),
    human_protein = apply(s4_table[,19:21], 1, mean, na.rm = TRUE)
  )
# Add the means to the s4 table
s4_table <- s4_table %>%
  mutate(
    chimp_mrna_mean = apply(s4_table[,4:9], 1, mean),
    human_mrna_mean = apply(s4_table[,10:15], 1, mean),
    chimp_protein_mean = apply(s4_table[,16:18], 1, mean),
    human_protein_mean = apply(s4_table[,19:21], 1, mean)
  )
```

## Question 1
```{r}
# Plotting function
plot_data <- function(data, title_suffix) {
  p1 <- ggplot(data, aes(x = human_mrna_mean, y = chimp_mrna_mean)) +
    geom_point() +
    labs(title = paste("mRNA for", title_suffix),
         x = "Human mRNA Mean",
         y = "Chimp mRNA Mean")
  
  p2 <- ggplot(data, aes(x = human_protein_mean, y = chimp_protein_mean)) +
    geom_point() +
    labs(title = paste("Protein for", title_suffix),
         x = "Human Protein Mean",
         y = "Chimp Protein Mean")
  
  # Return plots as a list for grid
  list(mRNA = p1, Protein = p2)
}

# Generate plots for s3_table and s4_table
s3_plots <- plot_data(s3_table, "Sample S3 (143)")
s4_plots <- plot_data(s4_table, "Sample S4 (159)")

grid.arrange(s3_plots$mRNA, s3_plots$Protein, s4_plots$mRNA, s4_plots$Protein, ncol = 2)
```

In these plots you can see that there is a relatively strong correlation between the mRNA means in each sample for Human vs. Chimp and each hold to about the same overall means on the graph. There is less of a strong correlation between proteins, comparatively, and we start to potentially see the difference in the proteome where S3 has, in general, greater values for the Chimp Protein means in S3 compared to the S4 Chimp Protein means.

## Question 2
```{r}
# Calculate correlations with cor()
calculate_correlations <- function(data, sample_name) {
  # Calculating correlation between human and chimp mRNA means
  cor_mRNA <- cor(data$human_mrna_mean, data$chimp_mrna_mean, use = "complete.obs")
  
  # Calculating correlation between human and chimp protein means
  cor_protein <- cor(data$human_protein_mean, data$chimp_protein_mean, use = "complete.obs")
  
  cat(paste("\nCorrelation of mRNA between humans and chimps for", sample_name, ":", cor_mRNA))
  cat(paste("\nCorrelation of protein between humans and chimps for", sample_name, ":", cor_protein))
}

# Calculate correlations for s3_table
calculate_correlations(s3_table, "Sample S3")

# Calculate correlations for s4_table
calculate_correlations(s4_table, "Sample S4")

```

We can see here that I was correct in saying that both the mRNA sample comparisons had a high correlation of about 0.957 each. I was also correct in saying that the protein sample comparisons had a low correlation (and both negative) where S3 is about -0.5 and S4 is about -0.221. S4's protein means has the least amount of correlation among all sample comparisons.

## Question 3
```{r}
# Linear model fits

# s3
lm_mRNA_s3 <- lm(chimp_mrna_mean ~ human_mrna_mean, data = s3_table)
lm_protein_s3 <- lm(chimp_protein_mean ~ human_protein_mean, data = s3_table)

# s4
lm_mRNA_s4 <- lm(chimp_mrna_mean ~ human_mrna_mean, data = s4_table)
lm_protein_s4 <- lm(chimp_protein_mean ~ human_protein_mean, data = s4_table)

# Print summaries

cat("Summary of mRNA model for S3:\n")
print(summary(lm_mRNA_s3))
cat("\nSummary of protein model for S3:\n")
print(summary(lm_protein_s3))

cat("----------------------------------------------\nSummary of mRNA model for S4:\n")
print(summary(lm_mRNA_s4))
cat("\nSummary of protein model for S4:\n")
print(summary(lm_protein_s4))


# Plot diagnostics

par(mfrow = c(2, 2))

# Diagnostic plots for S3 mRNA model
cat("\nDiagnostics for mRNA model s3_table:\n")
plot(lm_mRNA_s3, which = 1:4, main = "s3 mRNA")

# Diagnostic plots for S3 protein model
cat("\nDiagnostics for protein model s3_table:\n")
plot(lm_protein_s3, which = 1:4, main = "s3 Protein")

# Diagnostic plots for S4 mRNA model
cat("\nDiagnostics for mRNA model s4_table:\n")
plot(lm_mRNA_s4, which = 1:4, main = "s4 mRNA")

# Diagnostic plots for S4 protein model
cat("\nDiagnostics for protein model s4_table:\n")
plot(lm_protein_s4, which = 1:4, main = "s4 Protein")

par(mfrow = c(1, 1))

# ANOVA to test the significance of the relationship
cat("\nANOVA for mRNA model s3_table:\n")
print(anova(lm_mRNA_s3))
cat("\nANOVA for protein model s3_table:\n")
print(anova(lm_protein_s3))

cat("\nANOVA for mRNA model s4_table:\n")
print(anova(lm_mRNA_s4))
cat("\nANOVA for protein model s4_table:\n")
print(anova(lm_protein_s4))

```

Every p-value shows us a statistically significant correlation (P <0.05), where all but the protein model for S4 is highly significant.Our Anova analysis in the mRNA models shows both S3 and S4 showing extremely strong F-statistics (1569.4 and 1729.8 respectively), with corresponding p-values indicating the predictor (human mRNA mean) is a very strong determinant of the response (chimp mRNA mean). In the protein models, the F-statistics are lower (47.394 for S3 and 8.0642 for S4), reflecting the weaker relationships in protein models compared to mRNA models. The significance levels are still strong enough to affirm the relationships despite this.The mRNA models for both samples S3 and S4 exhibit very high R-squared values (approximately 91.7%), indicating excellent fits that explain a significant proportion of the variance in chimp mRNA levels based on human mRNA levels. In contrast, the protein models show much lower R-squared values, with 25.16% for S3 and a mere 4.88% for S4, indicating moderate to poor fits and suggesting that human protein levels are less predictive of chimp protein levels.

## Question 4





